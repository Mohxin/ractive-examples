<!doctype html>
<html>
<head>
	<!-- Bootstrap -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
	<link href='https://fonts.googleapis.com/css?family=Voltaire' rel='stylesheet' type='text/css'>
	<!-- JQuery -->
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<!-- Ractive -->
	<script src='https://cdn.jsdelivr.net/npm/ractive'></script>
	<!-- A bit of style -->
	<style>
		body {background-color:#eee;min-height:100%;font-family:Voltaire;}
	</style>
</head>
<body>
	<div class="container">
		<a class="pull-right" href="editor.html?url=partials-nav.html">View/Edit this code</a>
		<h1 class="text-center">Async content</h1>
		<div id="target"></div>
	</div>

	<script id='template' type='text/ractive'>
		<div class="col-sm-6">
			<h2>Fetching raw text</h2>
			<div class="input-group">
				<span class="input-group-btn">
					<button class="btn btn-default" on-click="@this.updateContent()">Fetch content</button>
				</span>
				<input class="form-control" value="{{urlContent}}" />
			</div>
			<hr/>
			<pre>{{asyncContent}}</pre>
		</div>
		<div class="col-sm-6">
			<h2>Fetching a template piece</h2>
			<div class="input-group">
				<span class="input-group-btn">
					<button class="btn btn-default" on-click="@this.updatePartial()">Fetch template piece</button>
				</span>
				<input class="form-control" value="{{urlPartial}}" />
			</div>
			<hr/>
			<div>{{>asyncPartial}}</div>
		</div>
	</script>

	<script>
		var ractive = new Ractive({
			target: '#target',
			template: '#template',
			data: {
				urlContent: 'https://www.w3.org/TR/PNG/iso_8859-1.txt',
				urlPartial: 'async_content_partial.ractive',
				foo: ''
			},
			partials: {
				asyncPartial: ''
			},
			updateContent: function() {
				var self = this;
				self.set('asyncContent', 'Loading...')
				$.get(self.get('urlContent'), function(data) {
					self.set('asyncContent', data)
				})
			},
			updatePartial: function() {
				var self = this;
				self.resetPartial('asyncPartial', 'Loading...')
				$.ajax({
					url: self.get('urlPartial'), 
					dataType: 'text',
					success: function(data) {
						console.log(data)
						self.resetPartial('asyncPartial', data)
					},
					error: function(msg) {
						console.warn(msg)
						self.resetPartial('asyncPartial', msg)
					}
				});
			}
		});
		
		
	</script>
</body>
</html>
